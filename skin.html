<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skin Diagnosis - Home</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #e3f2fd, #ffffff);
      color: #333;
      line-height: 1.6;
    }

    header {
      background: linear-gradient(135deg, #1565c0, #1e88e5);
      color: white;
      height: 150px;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      border-bottom-left-radius: 20px;
      border-bottom-right-radius: 20px;
    }

    header img {
      position: absolute;
      left: 30px;
      top: 50%;
      transform: translateY(-50%);
      height: 100px;
      width: auto;
      filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.2));
    }

    header h1 {
      font-size: 2.4rem;
      font-weight: 700;
      letter-spacing: 1px;
      text-shadow: 2px 2px 6px rgba(0,0,0,0.3);
    }

    .header-buttons {
      position: absolute;
      bottom: 20px;
      right: 30px;
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .profile-btn {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: white;
      border: 2px solid #1565c0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      color: #1565c0;
      font-size: 1.1rem;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: transform 0.2s ease, background 0.2s ease, color 0.2s ease;
    }

    .profile-btn:hover {
      transform: translateY(-2px);
      background: #1565c0;
      color: white;
    }

    .profile-menu {
      display: none;
      position: absolute;
      top: 70px;
      right: 30px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      padding: 1rem;
      width: 220px;
      text-align: left;
      z-index: 1000;
    }

    .profile-menu p {
      margin: 0 0 0.8rem 0;
      font-size: 0.95rem;
      color: #333;
      line-height: 1.5;
    }

    .logout-btn {
      background: #1565c0;
      color: white;
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 6px;
      font-size: 0.95rem;
      cursor: pointer;
      transition: background 0.3s ease;
      width: 100%;
      margin-top: 0.5rem;
    }

    .logout-btn:hover {
      background: #0d47a1;
    }

    .language-selector {
      background-color: white;
      padding: 0.6rem 1rem;
      border-radius: 30px;
      font-size: 1rem;
      font-weight: 600;
      color: #1565c0;
      border: none;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      cursor: pointer;
      transition: 0.3s ease;
    }

    .language-selector:hover {
      background: #0d47a1;
      color: white;
    }

    .header-buttons a {
      text-decoration: none;
      color: #1565c0;
      background-color: white;
      padding: 0.6rem 1.2rem;
      border-radius: 30px;
      font-size: 1rem;
      transition: 0.3s ease;
      font-weight: 700;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .header-buttons a:hover {
      background: #0d47a1;
      color: white;
      transform: translateY(-3px);
    }

    section {
      max-width: 1000px;
      margin: 2rem auto;
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    section h2 {
      color: #1565c0;
      margin-bottom: 1rem;
      font-size: 1.8rem;
    }

    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.2rem;
      margin-top: 1.2rem;
    }

    .feature-box {
      background: #e3f2fd;
      padding: 1rem;
      border-radius: 8px;
      transition: transform 0.2s ease-in-out;
    }

    .feature-box:hover {
      transform: translateY(-5px);
    }

    .steps {
      counter-reset: step-counter;
      margin-top: 1.5rem;
    }

    .step {
      margin-bottom: 1.5rem;
      padding-left: 3rem;
      position: relative;
    }

    .step:before {
      counter-increment: step-counter;
      content: counter(step-counter);
      position: absolute;
      left: 0;
      top: 0;
      background: #1565c0;
      color: white;
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .login-required {
      background: #fff3e0;
      border-left: 4px solid #ff9800;
      padding: 1rem;
      margin-top: 1rem;
      border-radius: 4px;
    }

    footer {
      text-align: center;
      padding: 1.5rem;
      background: #0d47a1;
      color: white;
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Skin Diagnosis Logo">
    <h1>Skin Diagnosis</h1>
    <div class="header-buttons" id="header-buttons">
      <select id="language-selector" class="language-selector" style="background-color: white; padding: 0.6rem 1rem; border-radius: 30px; font-size: 1rem; font-weight: 600; color: #1565c0; border: none; box-shadow: 0 4px 8px rgba(0,0,0,0.2); cursor: pointer; transition: 0.3s ease;">
        <option value="en">English</option>
        <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
        <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
        <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
        <option value="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</option>
        <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
      </select>
      <div id="login-signup-buttons" style="display: flex; gap: 1rem; align-items: center;">
        <a href="login.html" data-translate="login">Login</a>
        <a href="signup.html" data-translate="signup">Sign Up</a>
      </div>
      <div id="profile-section" style="display: none;">
        <div class="profile-btn" id="profile-btn" onclick="toggleProfileMenu()">U</div>
        <div class="profile-menu" id="profile-menu">
          <p><strong data-translate="user">User</strong>: <span id="profile-username" style="font-weight: normal; color: #1565c0;">User</span></p>
          <button class="logout-btn" onclick="logout()" data-translate="logout">Logout</button>
        </div>
      </div>
    </div>
  </header>

    <section>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
      <h2 data-translate="about_skin_diagnosis">About Skin Diagnosis</h2>
      <button class="speak-btn" onclick="speakAboutSection()" style="background: #1565c0; color: white; padding: 0.5rem 1rem; border: none; border-radius: 6px; font-size: 0.9rem; cursor: pointer;" data-translate="speak">üîä Speak</button>
    </div>
    <p id="about-text" data-translate="about_text">
      <strong>Skin Diagnosis</strong> is a web application that helps check your skin for different types of spots and lesions. 
      It can detect 7 conditions, including cancerous, pre-cancerous, and common moles. The web application looks at both colored 
      and non-colored spots to tell if they might be harmful. It gives quick results by analyzing skin images automatically. 
      This tool can help you or your doctor spot potentially serious skin problems early.
    </p>
  </section>

  <section>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
      <h2 data-translate="access_requirements">Access Requirements</h2>
      <button class="speak-btn" onclick="speakAccessSection()" style="background: #1565c0; color: white; padding: 0.5rem 1rem; border: none; border-radius: 6px; font-size: 0.9rem; cursor: pointer;" data-translate="speak">üîä Speak</button>
    </div>
    <div class="login-required">
      <p><strong>üîí <span data-translate="login_required">Login Required</span></strong></p>
      <p id="login-required-text" data-translate="login_required_text">To use the skin diagnosis features and upload images for analysis, you need to be logged into your account. 
         Please <a href="login.html" style="color: #1565c0; font-weight: 600;" data-translate="login">login</a> or 
         <a href="signup.html" style="color: #1565c0; font-weight: 600;" data-translate="signup">create a new account</a> to get started.</p>
    </div>
  </section>

  <section>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
      <h2 data-translate="how_it_works">How It Works - Step by Step Guide</h2>
      <button class="speak-btn" onclick="speakHowItWorksSection()" style="background: #1565c0; color: white; padding: 0.5rem 1rem; border: none; border-radius: 6px; font-size: 0.9rem; cursor: pointer;" data-translate="speak">üîä Speak</button>
    </div>
    <div class="steps">
      <div class="step">
        <strong data-translate="step1_title">Open the Web App</strong><br>
        <span data-translate="step1_desc">Visit the Skin Diagnosis web app in your browser on any device.</span>
      </div>
      <div class="step">
        <strong data-translate="step2_title">Upload Skin Image</strong><br>
        <span data-translate="step2_desc">Click the "Upload" button and select a clear photo of the skin area you want to check. Make sure the image is focused and well-lit.</span>
      </div>
      <div class="step">
        <strong data-translate="step3_title">Start Analysis</strong><br>
        <span data-translate="step3_desc">Press the "Analyze" or "Check" button. The app will automatically process the image using the trained AI model.</span>
      </div>
      <div class="step">
        <strong data-translate="step4_title">View Results</strong><br>
        <span data-translate="step4_desc">The app will display the detected condition. You may also see a probability or confidence score for each class.</span>
      </div>
      <div class="step">
        <strong data-translate="step5_title">Get Recommendations</strong><br>
        <span data-translate="step5_desc">Based on the result, the app may suggest: Consult a dermatologist immediately or confirmation tests for each disease separately.</span>
      </div>
      <div class="step">
        <strong data-translate="step6_title">Voice Assistance</strong><br>
        <span data-translate="step6_desc">By clicking the voice button, the user can listen to information about the recommendations and confirmation tests.</span>
      </div>
    </div>
  </section>

  <section>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
      <h2 data-translate="key_features">Key Features</h2>
      <button class="speak-btn" onclick="speakKeyFeaturesSection()" style="background: #1565c0; color: white; padding: 0.5rem 1rem; border: none; border-radius: 6px; font-size: 0.9rem; cursor: pointer;" data-translate="speak">üîä Speak</button>
    </div>
    <div class="features">
      <div class="feature-box">üñºÔ∏è Skin Condition Detection</div>
      <div class="feature-box">üé§ Voice-based Recommendations</div>
      <div class="feature-box">üîä Multilingual Support</div>
      <div class="feature-box">üîí Private and Secure</div>
      <div class="feature-box">üè• Accessible in Remote Areas</div>
    </div>
  </section>

  <footer>
    <p>¬© 2025 Skin Diagnosis | Accessible Skin Health</p>
  </footer>

  <script src="translation.js"></script>
  <script>
    // Check if user is logged in
    window.addEventListener('DOMContentLoaded', function() {
      checkLoginStatus();
    });

    async function checkLoginStatus() {
      const loggedIn = sessionStorage.getItem('loggedIn');
      
      if (loggedIn) {
        // Hide login/signup buttons, show profile
        const loginSignupButtons = document.getElementById('login-signup-buttons');
        const profileSection = document.getElementById('profile-section');
        
        if (loginSignupButtons) {
          loginSignupButtons.style.display = 'none';
        }
        if (profileSection) {
          profileSection.style.display = 'block';
        }
        
        // Fetch and display username
        await updateProfileDisplay();
      } else {
        // Show login/signup buttons, hide profile
        const loginSignupButtons = document.getElementById('login-signup-buttons');
        const profileSection = document.getElementById('profile-section');
        
        if (loginSignupButtons) {
          loginSignupButtons.style.display = 'flex';
        }
        if (profileSection) {
          profileSection.style.display = 'none';
        }
      }
    }

    async function updateProfileDisplay() {
      // First, try to use username from sessionStorage if available
      const storedUsername = sessionStorage.getItem('username');
      if (storedUsername && storedUsername !== 'User') {
        updateProfileUI(storedUsername);
      }
      
      // Fetch user info from API to get username
      try {
        const apiUrl = window.location.origin + '/api/user';
        const response = await fetch(apiUrl, {
          method: 'GET',
          credentials: 'include',
          mode: 'cors'
        });
        
        if (response.ok) {
          const data = await response.json();
          if (data.success && data.username) {
            sessionStorage.setItem('username', data.username);
            updateProfileUI(data.username);
          } else {
            const username = sessionStorage.getItem('username') || 'User';
            updateProfileUI(username);
          }
        } else {
          const username = sessionStorage.getItem('username') || 'User';
          updateProfileUI(username);
        }
      } catch (error) {
        console.error('Error fetching user info:', error);
        const username = sessionStorage.getItem('username') || 'User';
        updateProfileUI(username);
      }
    }
    
    // Translate dynamic content
    async function translateDynamicContent(lang) {
      if (lang === 'en') return;
      // Dynamic content is already translated via data-translate attributes
    }

    // Speak functions for each section - make them globally accessible
    window.speakAboutSection = async function() {
      try {
        const lang = getCurrentLanguage();
        const aboutText = document.getElementById('about-text');
        if (!aboutText) return;
        
        let text = translateText('about_skin_diagnosis', lang) + ': ' + aboutText.textContent;
        await speakText(text, lang);
      } catch (error) {
        console.error('Error in speakAboutSection:', error);
      }
    };

    window.speakAccessSection = async function() {
      try {
        const lang = getCurrentLanguage();
        const loginRequiredText = document.getElementById('login-required-text');
        if (!loginRequiredText) return;
        
        let text = translateText('access_requirements', lang) + ': ' + translateText('login_required', lang) + '. ' + loginRequiredText.textContent;
        await speakText(text, lang);
      } catch (error) {
        console.error('Error in speakAccessSection:', error);
      }
    };

    window.speakHowItWorksSection = async function() {
      try {
        const lang = getCurrentLanguage();
        const stepsDiv = document.querySelector('.steps');
        if (!stepsDiv) return;
        
        let text = translateText('how_it_works', lang) + ': ';
        stepsDiv.querySelectorAll('.step').forEach((step, idx) => {
          text += step.textContent + '. ';
        });
        
        await speakText(text, lang);
      } catch (error) {
        console.error('Error in speakHowItWorksSection:', error);
      }
    };

    window.speakKeyFeaturesSection = async function() {
      try {
        const lang = getCurrentLanguage();
        const featuresDiv = document.querySelector('.features');
        if (!featuresDiv) return;
        
        let text = translateText('key_features', lang) + ': ';
        featuresDiv.querySelectorAll('.feature-box').forEach((feature) => {
          text += feature.textContent + '. ';
        });
        
        await speakText(text, lang);
      } catch (error) {
        console.error('Error in speakKeyFeaturesSection:', error);
      }
    };

    function updateProfileUI(username) {
      const profileBtn = document.getElementById('profile-btn');
      const profileUsername = document.getElementById('profile-username');
      
      if (profileBtn) {
        const initial = username && username !== 'User' ? username.charAt(0).toUpperCase() : 'U';
        profileBtn.textContent = initial;
      }
      
      if (profileUsername) {
        profileUsername.textContent = username;
      }
    }

    function toggleProfileMenu() {
      const menu = document.getElementById('profile-menu');
      if (menu) {
        menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
      }
    }

    function logout() {
      const apiUrl = window.location.origin + '/api/logout';
      fetch(apiUrl, {
        method: 'POST',
        credentials: 'include',
        mode: 'cors'
      }).then(() => {
        sessionStorage.clear();
        window.location.reload();
      });
    }

    // Close profile menu when clicking outside
    document.addEventListener('click', function(e) {
      const profileBtn = document.getElementById('profile-btn');
      const profileMenu = document.getElementById('profile-menu');
      if (profileBtn && profileMenu && !profileBtn.contains(e.target) && !profileMenu.contains(e.target)) {
        profileMenu.style.display = 'none';
      }
    });
  </script>
</body>
</html>